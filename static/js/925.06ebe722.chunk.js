"use strict";(self.webpackChunkplaain=self.webpackChunkplaain||[]).push([[925],{7297:(e,r,n)=>{n.r(r),n.d(r,{default:()=>U});var t=n(467),s=n(5544),i=n(4756),a=n.n(i),o=n(5043),c=n(3003),u=n(4184),l=n(1215),d=n(209),v=n(8139),p=n.n(v),f=n(3550),h=n(579),m=function(e){var r=e.children,n=(0,f.Zp)(),t=history.length<=2,s=(0,o.useCallback)((function(){return n(-1)}),[n]);return(0,h.jsx)("div",{className:p()("Back",{disabled:t}),onClick:s,children:r})},x=n(5475),j=n(3959),b=n(3491),g=n.n(b),y=n(9121),k=n(6830),w=function(e,r){var n=e.find((function(e){return e.id===r}));if(void 0===n)throw new Error("Internal error: provider of item does not exist.");return n},P=function(e){return function(r){var n=w(e,r.provider.providerId);return{src:(0,j.SV)(n,r.provider),type:"video/".concat((0,j.uH)(r)),size:(0,j.Jh)(r.provider)}}},N=function(e){return function(r){var n=w(e,r.provider.providerId);return{kind:"captions",label:r.name,srcLang:(0,j.L8)(r),src:(0,j.SV)(n,r.provider)}}},_=function(e){var r=e.id,n=e.item,t=e.startAt,s=e.onProgress,i=(0,k.Zp)(),a=(0,c.d4)((function(e){return(0,y.a)(e.auth)}));return(0,o.useEffect)((function(){var e=!1,o=new(g())("video.PlyrPlayer#".concat(r),{debug:!1,controls:["play","progress","current-time","mute","volume","captions","settings","fullscreen"],settings:["captions","quality"],autoplay:!0,invertTime:!0,toggleInvert:!0});return o.source={type:"video",title:n.title,sources:n.sources.map(P(a)),tracks:n.captions.map(N(a))},o.on("canplay",(function(){e||void 0===t||o.duration<t||(o.forward(t),e=!0)})),o.on("ended",(function(){i((0,j.Pf)(n))})),function(){o.ended?s(0):0!==o.currentTime&&s(o.currentTime),o.destroy()}}),[r,n,i,s,a,t]),(0,h.jsx)("video",{className:"PlyrPlayer",id:r,crossOrigin:"anonymous",playsInline:!0,controls:!0})},A=n(4117),C=n(4870),I=function(e){var r=e.isActive,n=e.onClose,t=(0,A.Bd)().t,s=(0,o.useCallback)((function(){return window.location.reload()}),[]);return(0,h.jsx)("div",{className:"VideoDoesNotLoadModal",children:(0,h.jsxs)(C.a,{isActive:r,onClose:n,children:[(0,h.jsx)("h2",{children:t("The video doesn't load?")}),(0,h.jsx)("p",{className:"small",children:(0,h.jsxs)(A.x6,{children:["Restarting may help. Please"," ",(0,h.jsx)("a",{href:"https://github.com/jonhue/plaain/issues/new",target:"_blank",rel:"noopener noreferrer",children:"report the issue"})," ","if it persists."]})}),(0,h.jsx)("button",{className:"small",onClick:s,children:t("Reload")})]})})},S=n(2068),M=function(e){var r=e.item,n=e.startAt,t=e.onProgress,i=(0,A.Bd)().t,a=(0,S.h)(),o=(0,s.A)(a,3),c=o[0],u=o[1],l=o[2];return(0,h.jsxs)("div",{className:"Player",children:[(0,h.jsx)(_,{item:r,startAt:n,onProgress:t,id:"player"}),(0,h.jsx)("div",{className:"Player__content",children:(0,h.jsxs)("div",{className:"Player__content__header",children:[(0,h.jsx)("h1",{children:(0,h.jsx)(x.N_,{to:(0,j.Pf)(r),children:r.title})}),(0,h.jsxs)("div",{className:"Player__content__header__actions",children:[(0,h.jsx)("a",{onClick:function(e){e.preventDefault(),u()},children:i("Video not loading?")}),(0,h.jsx)(I,{isActive:c,onClose:l}),(0,h.jsx)(m,{children:(0,h.jsx)("button",{className:"secondary small",children:i("Go back")})})]})]})})]})},L=n(7873),R=n(6366),E=n(9114),T=n(1204),V=n(4777),B=n(9379),D=n(7087),O=n(7131);const U=function(){var e=(0,c.wA)(),r=(0,f.zy)(),n=(0,c.d4)((function(e){return{episodes:e.episodes,movies:e.movies}})),i=n.episodes,v=n.movies,p=(0,o.useState)(!1),m=(0,s.A)(p,2),x=m[0],j=m[1],b=(0,o.useMemo)((function(){var e=new URLSearchParams(r.search).get("s");if(null!==e)return Number.parseInt(e)}),[r]),g=(0,o.useMemo)((function(){var e=new URLSearchParams(r.search).get("type");if(null!==e){var n=Number.parseInt(e);return Object.values(u.u).includes(n)?n:void 0}}),[r]),y=(0,o.useCallback)((function(e,r){switch(e){case u.u.Episode:return(0,L.pr)(r)(i);case u.u.Movie:return(0,E.i3)(r)(v)}}),[i,v]),k=(0,O.e)((0,t.A)(a().mark((function n(){var t,s,i;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==g){n.next=2;break}return n.abrupt("return",j(!0));case 2:if(null!==(t=new URLSearchParams(r.search).get("id"))){n.next=5;break}return n.abrupt("return",j(!0));case 5:if(void 0!==(s=y(g,t))){n.next=8;break}return n.abrupt("return",j(!0));case 8:return n.next=10,e((0,R.H)((0,V.fM)(s)));case 10:return i=n.sent,n.abrupt("return",i);case 12:case"end":return n.stop()}}),n)}))),[e,g,r,j]),w=(0,o.useCallback)((function(r){if(void 0!==k)switch(k.kind){case u.u.Episode:return e((0,T.Q)(k,r));case u.u.Movie:return e(function(e,r){return function(n){var t={lastWatched:(new Date).toISOString(),progress:r};n((0,D.G)((0,B.A)((0,B.A)({},e),{},{usage:t})))}}(k,r))}}),[e,k]);return void 0!==k&&k.sources.length>0?(0,h.jsx)(M,{item:k,startAt:b,onProgress:w}):x?(0,h.jsx)(d.M,{}):(0,h.jsx)(l.R,{})}}}]);
//# sourceMappingURL=925.06ebe722.chunk.js.map